#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if standard-version is available
if ! command -v npx > /dev/null; then
  echo "Error: npx is not available. Please install Node.js and npm."
  exit 1
fi

# Sadece belirli commit türleri için versiyon oluştur
# Son etiketden sonraki commitlerde, feat, fix, perf türünde commit olup olmadığını kontrol et
LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
CURRENT_COMMITS=$(git log ${LAST_TAG}..HEAD --pretty=format:"%s" --no-merges)

# Versiyon arttıracak commit türleri
if echo "$CURRENT_COMMITS" | grep -E "^(feat|fix|perf|docs)(\(.+\))?!?:" > /dev/null; then
  echo "Versiyon arttıracak commitler bulundu. Sadece ana projede versiyon oluşturuluyor..."
  echo "Not: Paketler ve uygulamalar (packages/* ve apps/*) etkilenmeyecek."
  # Ensure we don't recursively version packages or apps
  npx standard-version --no-verify || {
    echo "Error: Failed to run standard-version. Please check if it's installed properly."
    echo "You can install it with: npm install --save-dev standard-version"
    exit 1
  }
else
  echo "Versiyon arttıracak commit bulunamadı. Versiyon atlanıyor."
fi 